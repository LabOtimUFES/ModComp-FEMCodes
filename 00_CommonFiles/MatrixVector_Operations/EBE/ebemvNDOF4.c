#include "../matvec.h"

int ebemvNDOF4(ParametersType *Parameters, MatrixDataType *MatrixData, FemStructsType *FemStructs, double *P, double *Q)
{
	if(NDIM == 2){
		int I, i1, i2, i3, i4, i5, i6, i7, i8, i9, i10, i11, i12;
		double p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11, p12;
		double **A;
		int neq, nel;
		int **lm = FemStructs->lm;

		neq = Parameters->neq;
		nel = Parameters->nel;

		A = MatrixData->A;

		for (I = 0; I < neq; I++)
			Q[I] = 0;

		P[neq] = 0;
		Q[neq] = 0;
	
		for(I = 0; I < nel; I++){
			i1 = lm[I][0];
			i2 = lm[I][1];
			i3 = lm[I][2];
			i4 = lm[I][3];
			i5 = lm[I][4];
			i6 = lm[I][5];
			i7 = lm[I][6];
			i8 = lm[I][7];
			i9 = lm[I][8];
			i10 = lm[I][9];
			i11 = lm[I][10];
			i12 = lm[I][11];

			p1 = P[i1];
			p2 = P[i2];
			p3 = P[i3];
			p4 = P[i4];
			p5 = P[i5];
			p6 = P[i6];
			p7 = P[i7];
			p8 = P[i8];
			p9 = P[i9];
			p10 = P[i10];
			p11 = P[i11];
			p12 = P[i12];

			Q[i1] += 	A[I][0]*p1 + A[I][1]*p2 + A[I][2]*p3
					+	A[I][3]*p4 + A[I][4]*p5 + A[I][5]*p6
					+	A[I][6]*p7 + A[I][7]*p8 + A[I][8]*p9
					+	A[I][9]*p10 + A[I][10]*p11 + A[I][11]*p12;

			Q[i2] += 	A[I][12]*p1 + A[I][13]*p2 + A[I][14]*p3
					+	A[I][15]*p4 + A[I][16]*p5 + A[I][17]*p6
					+	A[I][18]*p7 + A[I][19]*p8 + A[I][20]*p9
					+	A[I][21]*p10 + A[I][22]*p11 + A[I][23]*p12;

			Q[i3] += 	A[I][24]*p1 + A[I][25]*p2 + A[I][26]*p3
					+	A[I][27]*p4 + A[I][28]*p5 + A[I][29]*p6
					+	A[I][30]*p7 + A[I][31]*p8 + A[I][32]*p9
					+	A[I][33]*p10 + A[I][34]*p11 + A[I][35]*p12;

			Q[i4] += 	A[I][36]*p1 + A[I][37]*p2 + A[I][38]*p3
					+	A[I][39]*p4 + A[I][40]*p5 + A[I][41]*p6
					+	A[I][42]*p7 + A[I][43]*p8 + A[I][44]*p9
					+	A[I][45]*p10 + A[I][46]*p11 + A[I][47]*p12;

			Q[i5] += 	A[I][48]*p1 + A[I][49]*p2 + A[I][50]*p3
					+	A[I][51]*p4 + A[I][52]*p5 + A[I][53]*p6
					+	A[I][54]*p7 + A[I][55]*p8 + A[I][56]*p9
					+	A[I][57]*p10 + A[I][58]*p11 + A[I][59]*p12;

			Q[i6] += 	A[I][60]*p1 + A[I][61]*p2 + A[I][62]*p3
					+	A[I][63]*p4 + A[I][64]*p5 + A[I][65]*p6
					+	A[I][66]*p7 + A[I][67]*p8 + A[I][68]*p9
					+	A[I][69]*p10 + A[I][70]*p11 + A[I][71]*p12;

			Q[i7] += 	A[I][72]*p1 + A[I][73]*p2 + A[I][74]*p3
					+	A[I][75]*p4 + A[I][76]*p5 + A[I][77]*p6
					+	A[I][78]*p7 + A[I][79]*p8 + A[I][80]*p9
					+	A[I][81]*p10 + A[I][82]*p11 + A[I][83]*p12;

			Q[i8] += 	A[I][84]*p1 + A[I][85]*p2 + A[I][86]*p3
					+	A[I][87]*p4 + A[I][88]*p5 + A[I][89]*p6
					+	A[I][90]*p7 + A[I][91]*p8 + A[I][92]*p9
					+	A[I][93]*p10 + A[I][94]*p11 + A[I][95]*p12;

			Q[i9] += 	A[I][96]*p1 + A[I][97]*p2 + A[I][98]*p3
					+	A[I][99]*p4 + A[I][100]*p5 + A[I][101]*p6
					+	A[I][102]*p7 + A[I][103]*p8 + A[I][104]*p9
					+	A[I][105]*p10 + A[I][106]*p11 + A[I][107]*p12;

			Q[i10] += 	A[I][108]*p1 + A[I][109]*p2 + A[I][110]*p3
					+	A[I][111]*p4 + A[I][112]*p5 + A[I][113]*p6
					+	A[I][114]*p7 + A[I][115]*p8 + A[I][116]*p9
					+	A[I][117]*p10 + A[I][118]*p11 + A[I][119]*p12;

			Q[i11] += 	A[I][120]*p1 + A[I][121]*p2 + A[I][122]*p3
					+	A[I][123]*p4 + A[I][124]*p5 + A[I][125]*p6
					+	A[I][126]*p7 + A[I][127]*p8 + A[I][128]*p9
					+	A[I][129]*p10 + A[I][130]*p11 + A[I][131]*p12;

			Q[i12] += 	A[I][132]*p1 + A[I][133]*p2 + A[I][134]*p3
					+	A[I][135]*p4 + A[I][136]*p5 + A[I][137]*p6
					+	A[I][138]*p7 + A[I][139]*p8 + A[I][140]*p9
					+	A[I][141]*p10 + A[I][142]*p11 + A[I][143]*p12;

			Q[neq] = 0.0;

		}
	}else if (NDIM == 3){ //A*P=Q
		int I, i1, i2, i3, i4, i5, i6, i7, i8, i9, i10, i11, i12, i13, i14, i15, i16;
		double p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11, p12, p13, p14, p15, p16;
		double **A;
		int neq, nel;
		int **lm = FemStructs->lm;

		neq = Parameters->neq;
		nel = Parameters->nel;

		A = MatrixData->A;

		for (I = 0; I < neq; I++)
			Q[I] = 0;

		P[neq] = 0;
		Q[neq] = 0;
	
		for(I = 0; I < nel; I++){
			i1 = lm[I][0];
			i2 = lm[I][1];
			i3 = lm[I][2];
			i4 = lm[I][3];
			i5 = lm[I][4];
			i6 = lm[I][5];
			i7 = lm[I][6];
			i8 = lm[I][7];
			i9 = lm[I][8];
			i10 = lm[I][9];
			i11 = lm[I][10];
			i12 = lm[I][11];
			i13 = lm[I][12];
			i14 = lm[I][13];
			i15 = lm[I][14];
			i16 = lm[I][15];
			

			p1 = P[i1];
			p2 = P[i2];
			p3 = P[i3];
			p4 = P[i4];
			p5 = P[i5];
			p6 = P[i6];
			p7 = P[i7];
			p8 = P[i8];
			p9 = P[i9];
			p10 = P[i10];
			p11 = P[i11];
			p12 = P[i12];
			p13 = P[i13];
			p14 = P[i14];
			p15 = P[i15];
			p16 = P[i16];

			Q[i1] += 	A[I][0]*p1 + A[I][1]*p2 + A[I][2]*p3 + A[I][3]*p4
					+	A[I][4]*p5 + A[I][5]*p6	+ A[I][6]*p7 + A[I][7]*p8
					+	A[I][8]*p9 + A[I][9]*p10 + A[I][10]*p11 + A[I][11]*p12
					+	A[I][12]*p13 + A[I][13]*p14 + A[I][14]*p15 + A[I][15]*p16;

			Q[i2] +=  	A[I][16]*p1 + A[I][17]*p2 + A[I][18]*p3 + A[I][19]*p4
					+	A[I][20]*p5 + A[I][21]*p6 + A[I][22]*p7 + A[I][23]*p8
					+	A[I][24]*p9 + A[I][25]*p10 + A[I][26]*p11 + A[I][27]*p12
					+	A[I][28]*p13 + A[I][29]*p14 + A[I][30]*p15 + A[I][31]*p16;

			Q[i3] += 	A[I][32]*p1 + A[I][33]*p2 + A[I][34]*p3 + A[I][35]*p4
					+	A[I][36]*p5 + A[I][37]*p6 + A[I][38]*p7 + A[I][39]*p8
					+	A[I][40]*p9 + A[I][41]*p10 + A[I][42]*p11 + A[I][43]*p12
					+	A[I][44]*p13 + A[I][45]*p14 + A[I][46]*p15 + A[I][47]*p16;

			Q[i4] += 	A[I][48]*p1 + A[I][49]*p2 + A[I][50]*p3 + A[I][51]*p4
					+	A[I][52]*p5 + A[I][53]*p6 + A[I][54]*p7 + A[I][55]*p8
					+	A[I][56]*p9 + A[I][57]*p10 + A[I][58]*p11 + A[I][59]*p12
					+	A[I][60]*p13 + A[I][61]*p14 + A[I][62]*p15 + A[I][63]*p16;

			Q[i5] += 	A[I][64]*p1 + A[I][65]*p2 + A[I][66]*p3 + A[I][67]*p4
					+	A[I][68]*p5 + A[I][69]*p6 + A[I][70]*p7 + A[I][71]*p8
					+	A[I][72]*p9 + A[I][73]*p10 + A[I][74]*p11 + A[I][75]*p12
					+	A[I][76]*p13 + A[I][77]*p14 + A[I][78]*p15 + A[I][79]*p16;

			Q[i6] += 	A[I][80]*p1 + A[I][81]*p2 + A[I][82]*p3 + A[I][83]*p4
					+	A[I][84]*p5 + A[I][85]*p6 + A[I][86]*p7 + A[I][87]*p8
					+	A[I][88]*p9 + A[I][89]*p10 + A[I][90]*p11 + A[I][91]*p12
					+	A[I][92]*p13 + A[I][93]*p14 + A[I][94]*p15 + A[I][95]*p16;

			Q[i7] += 	A[I][96]*p1 + A[I][97]*p2 + A[I][98]*p3 + A[I][99]*p4
					+	A[I][100]*p5 + A[I][101]*p6 + A[I][102]*p7 + A[I][103]*p8
					+	A[I][104]*p9 + A[I][105]*p10 + A[I][106]*p11 + A[I][107]*p12
					+	A[I][108]*p13 + A[I][109]*p14 + A[I][110]*p15 + A[I][111]*p16;

			Q[i8] += 	A[I][112]*p1 + A[I][113]*p2 + A[I][114]*p3 + A[I][115]*p4
					+	A[I][116]*p5 + A[I][117]*p6 + A[I][118]*p7 + A[I][119]*p8
					+	A[I][120]*p9 + A[I][121]*p10 + A[I][122]*p11 + A[I][123]*p12
					+	A[I][124]*p13 + A[I][125]*p14 + A[I][126]*p15 + A[I][127]*p16;

			Q[i9] += 	A[I][128]*p1 + A[I][129]*p2 + A[I][130]*p3 + A[I][131]*p4
					+	A[I][132]*p5 + A[I][133]*p6 + A[I][134]*p7 + A[I][135]*p8
					+	A[I][136]*p9 + A[I][137]*p10 + A[I][138]*p11 + A[I][139]*p12
					+	A[I][140]*p13 + A[I][141]*p14 + A[I][142]*p15 + A[I][143]*p16;

			Q[i10] += 	A[I][144]*p1 + A[I][145]*p2 + A[I][146]*p3 + A[I][147]*p4
					+	A[I][148]*p5 + A[I][149]*p6 + A[I][150]*p7 + A[I][151]*p8
					+	A[I][152]*p9 + A[I][153]*p10 + A[I][154]*p11 + A[I][155]*p12
					+	A[I][156]*p13 + A[I][157]*p14 + A[I][158]*p15 + A[I][159]*p16;

			Q[i11] += 	A[I][160]*p1 + A[I][161]*p2 + A[I][162]*p3 + A[I][163]*p4
					+	A[I][164]*p5 + A[I][165]*p6 + A[I][166]*p7 + A[I][167]*p8
					+	A[I][168]*p9 + A[I][169]*p10 + A[I][170]*p11 + A[I][171]*p12
					+	A[I][172]*p13 + A[I][173]*p14 + A[I][174]*p15 + A[I][175]*p16;

			Q[i12] += 	A[I][176]*p1 + A[I][177]*p2 + A[I][178]*p3 + A[I][179]*p4
					+	A[I][180]*p5 + A[I][181]*p6 + A[I][182]*p7 + A[I][183]*p8
					+	A[I][184]*p9 + A[I][185]*p10 + A[I][186]*p11 + A[I][187]*p12
					+	A[I][188]*p13 + A[I][189]*p14 + A[I][190]*p15 + A[I][191]*p16;

			Q[i13] += 	A[I][192]*p1 + A[I][193]*p2 + A[I][194]*p3 + A[I][195]*p4
					+	A[I][196]*p5 + A[I][197]*p6 + A[I][198]*p7 + A[I][199]*p8
					+	A[I][200]*p9 + A[I][201]*p10 + A[I][202]*p11 + A[I][203]*p12
					+	A[I][204]*p13 + A[I][205]*p14 + A[I][206]*p15 + A[I][207]*p16;

			Q[i14] += 	A[I][208]*p1 + A[I][209]*p2 + A[I][210]*p3 + A[I][211]*p4
					+	A[I][212]*p5 + A[I][213]*p6 + A[I][214]*p7 + A[I][215]*p8
					+	A[I][216]*p9 + A[I][217]*p10 + A[I][218]*p11 + A[I][219]*p12
					+	A[I][220]*p13 + A[I][221]*p14 + A[I][222]*p15 + A[I][223]*p16;

			Q[i15] += 	A[I][224]*p1 + A[I][225]*p2 + A[I][226]*p3 + A[I][227]*p4
					+	A[I][228]*p5 + A[I][229]*p6 + A[I][230]*p7 + A[I][231]*p8
					+	A[I][232]*p9 + A[I][233]*p10 + A[I][234]*p11 + A[I][235]*p12
					+	A[I][236]*p13 + A[I][237]*p14 + A[I][238]*p15 + A[I][239]*p16;

			Q[i16] += 	A[I][240]*p1 + A[I][241]*p2 + A[I][242]*p3 + A[I][243]*p4
					+	A[I][244]*p5 + A[I][245]*p6 + A[I][246]*p7 + A[I][247]*p8
					+	A[I][248]*p9 + A[I][249]*p10 + A[I][250]*p11 + A[I][251]*p12
					+	A[I][252]*p13 + A[I][253]*p14 + A[I][254]*p15 + A[I][255]*p16;

			Q[neq] = 0.0;

		}
	}

	return 0;
}






